# RFC1 End-To-End Encryption

ID: RFC1
Author: Raffael Sahli <sahli@gyselroth.net>
Copyright: gyselroth GmbH 2018

## Description
This document describes an implementation of a secure client based End-To-End encryption for balloon.

## Server

### Description
The balloon server acts as key server. A new app called Balloon.App.PublicKey is provided for that usage.

### API Endpoints
This very app provides following new API Endpoints:

#### Request registered devices

Request all registered devices owned by user who gets authenticated during the requst.
It is not possible to received any other devices than those owned by the user itself.

**Endpoint**: GET /api/v?/public-key/devices
Success response:
```
(number) status HTTP status code (200 for a successfuly response)
(array[]) data[] Array of device objects
(string) data.id Device id (server generates one)
(string) data.device_identifier (Defined by client)
(string) data.public_key (Public key uploaded by client)
```

Example response:
```
GET /api/v?/public-key/devices
{
    "status": 200,
    "data": [
        {	
            "id": "807f191e810c19729de860ea",
            "device_identifier": "myhostname (Linux Mint 17)",
            "public_key": "base64 encoded public key"
        }
    ]
}
```

### Create new device
Create a new client device.

**Endpoint**: PUT /api/v?/public-key

Request parameters:
```
(string) device_identifier A device identifier (human readable)
(string) public_key Base64 encoded public key in pem format 
```

Success response:
```
(number) status HTTP status code (201 for a successfuly response)
(string) data The id generated by the server
```

Example response:
```
PUT /api/v?/public-key?device_identifier=Thinkpad%s204266%20Windows10&public_key=base64_encoded_pem_pubkey
{
    "status": 200,
    "data": "807f191e810c19729de860cc"
}
```

Possible error response:
* Device identifier already exists (400 Bad request)
* Publickey fingerprint already exists (400 Bad request)


## Restrictions

### Server apps 
All server apps which work content based are not usable for encrypted content. Following apps are affected and not usable or only partially usable for encrypted files:
 
* Balloon.App.Preview
The server is not able to generate previews for encrypted files

* Balloon.App.ClamAv
Encrypted files can not be scanned for any malware/viruses

* Balloon.App.Elasticsearch
Fulltext search is not possible due file encryption, however it is still possible to search for meta relevant information like tags, name, author.

* Balloon.App.Office
Office formats like doc, docx, xls, xlsx, ppt, pptx are not editable nor viewable.

* Balloon.App.Convert
No documents can be converted anymore by the server automatically. This is true for any document.

* Balloon.App.Sharelink
World wide accessable links theoretically still work for encrypted files, however since the content is encrypted and can only be decrypted by specific clients the contents provided by those links would be unsuable.
